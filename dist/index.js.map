{"version":3,"sources":["../src/index.js"],"sourcesContent":["\"use strict\";\n\nconst PDFDocument = require(\"pdfkit\");\nconst path = require(\"path\");\nconst fs = require(\"fs\");\nconst _merge = require(\"lodash.merge\");\nconst transliterate = require(\"transliteration\").transliterate;\n\n/**\n * Invoice\n * This is the constructor that creates a new instance containing the needed\n * methods.\n *\n * @name Invoice\n * @function\n * @param {Object} options The options for creating the new invoice:\n */\nmodule.exports = class FastInvoice {\n  constructor(options) {\n    this.defaultOptions = {\n      style: {\n        document: {\n          marginLeft: 30,\n          marginRight: 30,\n          marginTop: 30,\n        },\n\n        fonts: {\n          normal: {\n            name: \"Helvetica\",\n            range: /[^\\u0000-\\u00FF]/m,\n          },\n          bold: {\n            name: \"Helvetica-Bold\",\n          },\n          fallback: {\n            name: \"Noto Sans\",\n            path: path.join(__dirname, \"../res/fonts/\", \"NotoSans-Regular.ttf\"),\n            enabled: true,\n            range: /[^\\u0000-\\u0500]/m,\n            transliterate: true,\n          },\n        },\n        header: {\n          backgroundColor: \"#F8F8FA\",\n          height: 150,\n          image: null,\n          textPosition: 330,\n        },\n        table: {\n          quantity: {\n            position: 330,\n            maxWidth: 140,\n          },\n          total: {\n            position: 490,\n            maxWidth: 80,\n          },\n        },\n        text: {\n          primaryColor: \"#000100\",\n          secondaryColor: \"#8F8F8F\",\n          headingSize: 15,\n          regularSize: 10,\n        },\n      },\n\n      data: {\n        invoice: {\n          name: \"Invoice for Acme\",\n          header: [\n            {\n              label: \"Invoice Number\",\n              value: 1,\n            },\n          ],\n          customer: [\n            {\n              label: \"Bill To\",\n              value: [],\n            },\n          ],\n          seller: [\n            {\n              label: \"Bill From\",\n              value: [],\n            },\n          ],\n          details: {\n            header: [\n              {\n                value: \"Description\",\n              },\n              {\n                value: \"Quantity\",\n              },\n              {\n                value: \"Subtotal\",\n              },\n            ],\n            parts: [],\n            total: [\n              {\n                label: \"Total\",\n                value: 0,\n              },\n            ],\n          },\n          legal: [],\n        },\n      },\n    };\n\n    this.options = _merge(this.defaultOptions, options);\n\n    this.storage = {\n      header: {\n        image: null,\n      },\n      cursor: {\n        x: 0,\n        y: 0,\n      },\n      customer: {\n        height: 0,\n      },\n      seller: {\n        height: 0,\n      },\n      fonts: {\n        fallback: {\n          loaded: false,\n        },\n      },\n      document: null,\n    };\n  }\n\n  /**\n   * Load custom fonts\n   *\n   * @private\n   * @return void\n   */\n  loadCustomFonts() {\n    // Register custom fonts\n    if (this.options.style.fonts.normal.path) {\n      this.document.registerFont(\n        this.options.style.fonts.normal.name,\n        this.options.style.fonts.normal.path\n      );\n    }\n\n    if (this.options.style.fonts.bold.path) {\n      this.document.registerFont(\n        this.options.style.fonts.bold.name,\n        this.options.style.fonts.bold.path\n      );\n    }\n  }\n\n  /**\n   * Load fallback font (unicode chars)\n   *\n   * @private\n   * @return void\n   */\n  getFontOrFallback(type, value) {\n    let _normalRange = this.options.style.fonts.normal.range;\n    let _fallbackRange = this.options.style.fonts.fallback.range;\n\n    if (type !== \"normal\" && type !== \"bold\") {\n      type = \"normal\";\n    }\n\n    // Return default font\n    if (this.options.style.fonts.fallback.enabled === false) {\n      return this.options.style.fonts[type].name;\n    }\n\n    // Return default font if not special chars are found\n    if (!_normalRange.test((value || \"\").toString())) {\n      return this.options.style.fonts[type].name;\n    }\n\n    // Return default font if fallback font if range not supported\n    if (_fallbackRange.test((value || \"\").toString())) {\n      return this.options.style.fonts[type].name;\n    }\n\n    if (this.storage.fonts.fallback.loaded === false) {\n      this.document.registerFont(\n        this.options.style.fonts.fallback.name,\n        this.options.style.fonts.fallback.path\n      );\n      this.storage.fonts.fallback.loaded = true;\n    }\n\n    // Return fallback font\n    return this.options.style.fonts.fallback.name;\n  }\n\n  /**\n   * Show value or transliterate\n   *\n   * @private\n   * @param  {string} value\n   * @return void\n   */\n  valueOrTransliterate(value) {\n    let _fallbackRange = this.options.style.fonts.fallback.range;\n\n    // Return default font\n    if (this.options.style.fonts.fallback.enabled === false) {\n      return value;\n    }\n\n    // Return default font if not special chars are found\n    if (!_fallbackRange.test((value || \"\").toString())) {\n      return value;\n    }\n\n    return transliterate(value);\n  }\n\n  /**\n   * Generates the header\n   *\n   * @private\n   * @return void\n   */\n  generateHeader() {\n    // Background Rectangle\n    this.document\n      .rect(0, 0, this.document.page.width, this.options.style.header.height)\n      .fill(this.options.style.header.backgroundColor);\n\n    // Add an image to the header if any\n    if (\n      this.options.style.header.image &&\n      this.options.style.header.image.path\n    ) {\n      this.document.image(\n        this.options.style.header.image.path,\n        this.options.style.document.marginLeft,\n        this.options.style.document.marginTop,\n        {\n          width: this.options.style.header.image.width,\n          height: this.options.style.header.image.height,\n        }\n      );\n    }\n\n    let _fontMargin = 4;\n\n    // Write header details\n    this.setCursor(\"x\", this.options.style.header.textPosition);\n    this.setCursor(\"y\", this.options.style.document.marginTop);\n\n    this.setText(this.options.data.invoice.name, {\n      fontSize: \"heading\",\n      fontWeight: \"bold\",\n      color: this.options.style.header.regularColor,\n    });\n\n    this.options.data.invoice.header.forEach((line) => {\n      this.setText(`${line.label}:`, {\n        fontWeight: \"bold\",\n        color: this.options.style.header.regularColor,\n        marginTop: _fontMargin,\n      });\n\n      let _values = [];\n\n      if (Array.isArray(line.value)) {\n        _values = line.value;\n      } else {\n        _values = [line.value];\n      }\n\n      _values.forEach((value) => {\n        this.setText(value, {\n          colorCode: \"secondary\",\n          color: this.options.style.header.secondaryColor,\n          marginTop: _fontMargin,\n        });\n      });\n    });\n  }\n\n  /**\n   * Generates customer and seller\n   *\n   * @private\n   * @return void\n   */\n  generateDetails(type) {\n    let _maxWidth = 250;\n    let _fontMargin = 4;\n\n    this.setCursor(\"y\", this.options.style.header.height + 18);\n\n    // Use a different left position\n    if (type === \"customer\") {\n      this.setCursor(\"x\", this.options.style.document.marginLeft);\n    } else {\n      this.setCursor(\"x\", this.options.style.header.textPosition);\n    }\n\n    this.options.data.invoice[type].forEach((line) => {\n      this.setText(`${line.label}:`, {\n        colorCode: \"primary\",\n        fontWeight: \"bold\",\n        marginTop: 8,\n        maxWidth: _maxWidth,\n      });\n\n      let _values = [];\n\n      if (Array.isArray(line.value)) {\n        _values = line.value;\n      } else {\n        _values = [line.value];\n      }\n\n      _values.forEach((value) => {\n        this.setText(value, {\n          colorCode: \"secondary\",\n          marginTop: _fontMargin,\n          maxWidth: _maxWidth,\n        });\n      });\n    });\n\n    this.storage[type].height = this.storage.cursor.y;\n  }\n\n  /**\n   * Generates a row\n   *\n   * @private\n   * @param  {string} type\n   * @param  {array} columns\n   * @return void\n   */\n  generateTableRow(type, columns) {\n    let _fontWeight = \"normal\",\n      _colorCode = \"secondary\";\n\n    this.storage.cursor.y = this.document.y;\n\n    this.storage.cursor.y += 17;\n\n    if (type === \"header\") {\n      _fontWeight = \"bold\";\n      _colorCode = \"primary\";\n    }\n\n    let _start = this.options.style.document.marginLeft;\n    let _maxY = this.storage.cursor.y;\n\n    // Computes columns by giving an extra space for the last column \\\n    //   It is used to keep a perfect alignement\n    let _maxWidth =\n      (this.options.style.header.textPosition -\n        _start -\n        this.options.style.document.marginRight) /\n      (columns.length - 2);\n\n    columns.forEach((column, index) => {\n      let _value;\n\n      if (index < columns.length - 2) {\n        this.setCursor(\"x\", _start);\n      } else {\n        if (index == columns.length - 2) {\n          _maxWidth = this.options.style.table.quantity.maxWidth;\n          this.setCursor(\"x\", this.options.style.table.quantity.position);\n        } else {\n          _maxWidth = this.options.style.table.total.maxWidth;\n          this.setCursor(\"x\", this.options.style.table.total.position);\n        }\n      }\n\n      _value = column.value;\n\n      if (column.price === true) {\n        _value = this.prettyPrice(_value);\n      }\n\n      this.setText(_value, {\n        colorCode: _colorCode,\n        maxWidth: _maxWidth,\n        fontWeight: _fontWeight,\n        skipDown: true,\n      });\n\n      _start += _maxWidth + 10;\n\n      // Increase y position in case of a line return\n      if (this.document.y >= _maxY) {\n        _maxY = this.document.y;\n      }\n    });\n\n    // Set y to the max y position\n    this.setCursor(\"y\", _maxY);\n\n    if (type === \"header\") {\n      this.generateLine();\n    }\n  }\n\n  /**\n   * Generates a line separator\n   *\n   * @private\n   * @return void\n   */\n  generateLine() {\n    this.storage.cursor.y += this.options.style.text.regularSize + 2;\n\n    this.document\n      .strokeColor(\"#F0F0F0\")\n      .lineWidth(1)\n      .moveTo(this.options.style.document.marginRight, this.storage.cursor.y)\n      .lineTo(\n        this.document.page.width - this.options.style.document.marginRight,\n        this.storage.cursor.y\n      )\n      .stroke();\n  }\n\n  /**\n   * Generates invoice parts\n   *\n   * @private\n   * @return void\n   */\n  generateParts() {\n    let _startY = Math.max(\n      this.storage.customer.height,\n      this.storage.seller.height\n    );\n\n    let _fontMargin = 4;\n    let _leftMargin = 15;\n\n    this.setCursor(\"y\", _startY);\n\n    this.setText(\"\\n\");\n\n    this.generateTableRow(\"header\", this.options.data.invoice.details.header);\n\n    (this.options.data.invoice.details.parts || []).forEach((part) => {\n      this.generateTableRow(\"row\", part);\n    });\n\n    this.storage.cursor.y += 50;\n\n    (this.options.data.invoice.details.total || []).forEach((total) => {\n      let _mainRatio = 0.6,\n        _secondaryRatio = 0.3;\n      let _margin = 30;\n      let _value = total.value;\n\n      this.setCursor(\"x\", this.options.style.table.quantity.position);\n      this.setText(total.label, {\n        colorCode: \"primary\",\n        fontWeight: \"bold\",\n        marginTop: 12,\n        maxWidth: this.options.style.table.quantity.maxWidth,\n        skipDown: true,\n      });\n\n      this.setCursor(\"x\", this.options.style.table.total.position);\n\n      if (total.price === true) {\n        _value = this.prettyPrice(total.value);\n      }\n\n      this.setText(_value, {\n        colorCode: \"secondary\",\n        maxWidth: this.options.style.table.total.maxWidth,\n      });\n    });\n  }\n\n  /**\n   * Generates legal terms\n   *\n   * @private\n   * @return void\n   */\n  generateLegal() {\n    this.storage.cursor.y += 60;\n\n    (this.options.data.invoice.legal || []).forEach((legal) => {\n      this.setCursor(\"x\", this.options.style.document.marginLeft * 2);\n\n      this.setText(legal.value, {\n        fontWeight: legal.weight,\n        colorCode: legal.color || \"primary\",\n        align: \"center\",\n        marginTop: 10,\n      });\n    });\n  }\n\n  /**\n   * Moves the internal cursor\n   *\n   * @private\n   * @param  {string} axis\n   * @param  {number} value\n   * @return void\n   */\n  setCursor(axis, value) {\n    this.storage.cursor[axis] = value;\n  }\n\n  /**\n   * Convert numbers to fixed value and adds currency\n   *\n   * @private\n   * @param  {string | number} value\n   * @return string\n   */\n  prettyPrice(value) {\n    if (typeof value === \"number\") {\n      value = value.toFixed(2);\n    }\n\n    if (this.options.data.invoice.currency) {\n      value = `${value} ${this.options.data.invoice.currency}`;\n    }\n\n    return value;\n  }\n\n  /**\n   * Adds text on the invoice with specified optons\n   *\n   * @private\n   * @param  {string} text\n   * @param  {object} options\n   * @return void\n   */\n  setText(text, options = {}) {\n    let _fontWeight = options.fontWeight || \"normal\";\n    let _colorCode = options.colorCode || \"primary\";\n    let _fontSize = options.fontSize || \"regular\";\n    let _textAlign = options.align || \"left\";\n    let _color = options.color || \"\";\n    let _marginTop = options.marginTop || 0;\n    let _maxWidth = options.maxWidth;\n    let _fontSizeValue = 0;\n\n    this.storage.cursor.y += _marginTop;\n\n    if (!_color) {\n      if (_colorCode === \"primary\") {\n        this.document.fillColor(this.options.style.text.primaryColor);\n      } else {\n        this.document.fillColor(this.options.style.text.secondaryColor);\n      }\n    }\n\n    if (_fontSize === \"regular\") {\n      _fontSizeValue = this.options.style.text.regularSize;\n    } else {\n      _fontSizeValue = this.options.style.text.headingSize;\n    }\n\n    this.document.font(this.getFontOrFallback(_fontWeight, text));\n\n    this.document.fillColor(_color);\n    this.document.fontSize(_fontSizeValue);\n\n    this.document.text(\n      this.valueOrTransliterate(text),\n      this.storage.cursor.x,\n      this.storage.cursor.y,\n      {\n        align: _textAlign,\n        width: _maxWidth,\n      }\n    );\n\n    let _diff = this.document.y - this.storage.cursor.y;\n\n    this.storage.cursor.y = this.document.y;\n\n    // Do not move down\n    if (options.skipDown === true) {\n      if (_diff > 0) {\n        this.storage.cursor.y -= _diff;\n      } else {\n        this.storage.cursor.y -= 11.5;\n      }\n    }\n  }\n\n  /**\n   * Generates a PDF invoide\n   *\n   * @public\n   * @param  {string|object} output\n   * @return Promise\n   */\n  generate(output) {\n    let _stream = null;\n\n    this.document = new PDFDocument({\n      size: \"A4\",\n    });\n\n    this.loadCustomFonts();\n    this.generateHeader();\n    this.generateDetails(\"customer\");\n    this.generateDetails(\"seller\");\n    this.generateParts();\n    this.generateLegal();\n\n    if (typeof output === \"string\" || (output || {}).type === \"file\") {\n      let _path = \"\";\n\n      if (typeof output === \"string\") {\n        _path = output;\n      } else {\n        _path = output.path;\n      }\n\n      _stream = fs.createWriteStream(output);\n\n      this.document.pipe(_stream);\n      this.document.end();\n    } else {\n      this.document.end();\n      return this.document;\n    }\n\n    return new Promise((resolve, reject) => {\n      this.document.on(\"end\", () => {\n        return resolve();\n      });\n\n      this.document.on(\"error\", () => {\n        return reject();\n      });\n    });\n  }\n};\n"],"mappings":"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","names":[]}